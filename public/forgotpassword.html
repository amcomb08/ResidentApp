<!DOCTYPE html>
<html lang="en">
<head>
    <title>Page title</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap">
    <link rel="stylesheet" href="css/tailwind/tailwind.min.css">
    <link rel="icon" type="image/png" sizes="32x32" href="images/Logo.png">
    <script src="js/main.js"></script>
</head>
<body class="antialiased bg-body text-body font-body">
    <div class="">
                
      <section class="py-36">
        <div class="container px-4 mx-auto">
          <div class="relative max-w-lg mx-auto pt-16 pb-16 px-6 md:px-10 lg:px-16 bg-gray-500 rounded-xl">
            <a class="absolute top-0 left-1/2 transform -translate-x-1/2 -translate-y-1/2" href="#">
              <img class="block" src="trizzle-assets/logos/trizzle-logo-blue.svg" alt="">
            </a>
            <div class="relative max-w-md mx-auto text-center">
              <h2 class="text-2xl text-gray-100 font-semibold mb-2">Forgot Password?</h2>
              <p class="text-gray-300 font-medium mb-10">Don't worry! Enter your email and we will send you a code to reset your password.</p>
              <form id="forgotPasswordForm" action="/send-reset-code" method="post">
                <div class="relative w-full h-14 py-4 px-3 mb-8 border border-gray-400 hover:border-white focus-within:border-green-500 rounded-lg">
                  <span class="absolute bottom-full left-0 ml-3 -mb-1 transform translate-y-0.5 text-xs font-semibold text-gray-300 px-1 bg-gray-500">Email</span>
                  <input class="block w-full outline-none bg-transparent text-sm text-gray-100 font-medium" id="userEmail" name="email" type="email" required>
                </div>
                
                <div class="flex flex-wrap items-center justify-between mb-6">
                  <div class="flex items-center mb-4 sm:mb-0">
                    
                    
                  </div>
                  <div class="w-full sm:w-auto"></div>
                </div>
                <button type="submit" id="sendLinkButton" class="block w-full py-4 mb-4 leading-6 text-white font-semibold bg-blue-500 hover:bg-blue-600 rounded-lg transition duration-200">Send Link</button>
                
                <p class="font-medium">
                  
                  
                </p>
              </form>
            </div>
          </div>
        </div>
      </section>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <script src="js/charts-demo.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', (event) => {
        document.getElementById('forgotPasswordForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            let email = document.getElementById('userEmail').value;
            let response = await fetch('http://localhost:5000/login/send-reset-code', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email }),
            });
            let data = await response.json();
            console.log(data);
            if (data.success) {
                // Remove existing alert if present
                const existingAlert = document.querySelector('.verification-code-alert');
                if (existingAlert) {
                    existingAlert.remove();
                }
    
                // Create a new input field for the verification code
                const verificationInput = document.createElement('input');
                verificationInput.setAttribute('type', 'text');
                verificationInput.setAttribute('id', 'verificationCode');
                verificationInput.setAttribute('placeholder', 'Enter Verification Code');
                verificationInput.classList.add('block', 'w-full', 'outline-none', 'bg-transparent', 'text-sm', 'text-gray-100', 'font-medium', 'py-4', 'px-3', 'mb-8', 'border', 'border-gray-400', 'hover:border-white', 'focus-within:border-green-500', 'rounded-lg');
                
                // Optionally, create a submit button for the code
                const submitCodeButton = document.createElement('button');
                submitCodeButton.textContent = 'Submit Code';
                submitCodeButton.classList.add('block', 'w-full', 'py-4', 'mb-4', 'leading-6', 'text-white', 'font-semibold', 'bg-blue-500', 'hover:bg-blue-600', 'rounded-lg', 'transition', 'duration-200');
                submitCodeButton.addEventListener('click', async function(e) {
                    e.preventDefault();
                    // Get the entered verification code
                    let verificationCode = document.getElementById('verificationCode').value;
                    
                    // Send the verification code to the server
                    let verifyResponse = await fetch('http://localhost:5000/login/verify-reset-code', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ email, verificationCode }),
                        credentials: 'include'
                    });
                    let verifyData = await verifyResponse.json();
                    
                    // Check if the verification was successful
                    if (verifyData.success) {
                      document.cookie = "authenticated=true; path=/";  // Set the authenticated cookie
                      window.location = 'changepassword.html?type=link';
                    } else {
                        // Inform the user if there was an error
                        alert(verifyData.message);
                    }
                });
                // Append the new input field and button to the form or a specific element
                const form = document.getElementById('forgotPasswordForm');
                form.appendChild(verificationInput);
                form.appendChild(submitCodeButton);
                document.getElementById('sendLinkButton').style.display = 'none';
    
                alert('Check your email for the reset link.');
            } else {
                alert(data.message);
            }
        });
      });
    </script>        
</body>
</html>

