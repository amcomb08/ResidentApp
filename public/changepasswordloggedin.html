<!DOCTYPE html>
<html lang="en">
<head>
    <title>Page title</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap">
    <link rel="stylesheet" href="css/tailwind/tailwind.min.css">
    <link rel="icon" type="image/png" sizes="32x32" href="images/Logo.png">
    <script src="js/main.js"></script>
</head>
<body class="antialiased bg-body text-body font-body">
  <script>
      checkLogin("Resident");
  </script>
    <div class="">
      <section class="py-36">
        <div class="container px-4 mx-auto">
          <div class="relative max-w-lg mx-auto pt-16 pb-16 px-6 md:px-10 lg:px-16 bg-gray-500 rounded-xl">
            <a class="absolute top-0 left-1/2 transform -translate-x-1/2 -translate-y-1/2" href="#"></a>
            <div class="relative max-w-md mx-auto">
              <div class="text-center mb-10">
                <h2 class="text-2xl text-gray-100 font-semibold mb-2" contenteditable="false">Change your password</h2>
              </div>
              <form id = "changePassword">
                <div class="relative w-full h-14 py-4 px-3 mb-8 border border-gray-400 hover:border-white focus-within:border-green-500 rounded-lg">
                  <span class="absolute bottom-full left-0 ml-3 -mb-1 transform translate-y-0.5 text-xs font-semibold text-gray-300 px-1 bg-gray-500" contenteditable="false">New Password</span>
                  <input class="block w-full outline-none bg-transparent text-sm text-gray-100 font-medium" id="newPassword" type="password">
                </div>
                <div class="relative w-full h-14 py-4 px-3 mb-8 border border-gray-400 hover:border-white focus-within:border-green-500 rounded-lg">
                  <span class="absolute bottom-full left-0 ml-3 -mb-1 transform translate-y-0.5 text-xs font-semibold text-gray-300 px-1 bg-gray-500">Confirm New Password</span>
                  <input class="block w-full outline-none bg-transparent text-sm text-gray-100 font-medium" id="confirmNewPassword" type="password" required>
                </div>
                <span class="block text-xs text-gray-300 font-semibold mb-6" contenteditable="false">Must be at least 12 characters.</span>
                <button type="submit" class="block w-full py-4 mb-4 leading-6 text-white font-semibold bg-blue-500 hover:bg-blue-600 rounded-lg transition duration-200">Confirm</button>
                <p class="font-medium text-center"></p>
              </form>
            </div>
          </div>
        </div>
      </section>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <script src="js/charts-demo.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', (event) => {
        document.getElementById('changePassword').addEventListener('submit', async (e) => {
            e.preventDefault();
            let newPassword = document.getElementById('newPassword').value;
            let confirmNewPassword = document.getElementById('confirmNewPassword').value;
            let response = await fetch('http://localhost:5000/login/changepasswordloggedin', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ newPassword,confirmNewPassword }),
                credentials: 'include' 
                });
            let data = await response.json();
            console.log(data.success);
            if (data.success) {
                document.cookie = "authenticated=true; path=/";  // Set the authenticated cookie
                window.location = 'index.html';
            } else {
                alert(data.message);
            }
        });
      });
    </script>
</body>
</html>

